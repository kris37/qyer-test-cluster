<?xml version="1.0"?>
<!--
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License. See accompanying LICENSE file.
-->
<configuration>

<!-- Site specific YARN configuration properties -->
	<property>
        <name>yarn.resourcemanager.hostname</name>
        <value>10.1.10.32</value>
    </property>

     <!-- Site specific YARN configuration properties -->
    <property>
        <name>yarn.nodemanager.aux-services</name>
        <value>mapreduce_shuffle</value>
    </property>
    <property>
        <name>yarn.nodemanager.aux-services.mapreduce_shuffle.class</name>
        <value>org.apache.hadoop.mapred.ShuffleHandler</value>
    </property>
	<property>
        <name>yarn.resourcemanager.scheduler.class</name>
        <value>org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.CapacityScheduler</value>
    </property>
     <property>
        <name>yarn.resourcemanager.recovery.enabled</name>
        <value>false</value>
    </property>
    <!--testing setting in docker 2 nodes ,each node max memory is totaol 3g(os reserved=1GB usableMem=2GB) ,cup is 2cores-->
     <!-- 一个container最小申请的内存 此处设置2G，因为还有cup 资源的限制所以这里采用2g，环境中小文件块大小为128M-->
    <property>
        <name>yarn.scheduler.minimum-allocation-mb</name>
        <value>2048</value>
    </property>
     <!-- 一个container最大申请的内存,此处设置50G内存,体现在spark上executor最好设置成48G-->
    <property>
        <name>yarn.scheduler.maximum-allocation-mb</name>
        <value>51200</value>
    </property>
        <!--CPU资源-->
    <property>
        <name>yarn.scheduler.minimum-allocation-vcores</name>
        <value>1</value>
    </property>
    <!--最大占据一半的cpu-->
    <property>
        <name>yarn.scheduler.maximum-allocation-vcores</name>
        <value>20</value>
    </property>
      <!-- NodeManager提供的最大内存 此处设置50g内存,机器的内存是64G内存-->
    <property>
        <name>yarn.nodemanager.resource.memory-mb</name>
        <value>51200</value>
    </property>

 <!-- 虚拟内存和物理内存的比重2.7->8.1 -->
    <property>
        <name>yarn.nodemanager.vmem-pmem-ratio</name>
        <value>8.1</value>
    </property>
    <!--机器的cpu是40核,我们用32核-->
    <property>
        <name>yarn.nodemanager.resource.cpu-vcores</name>
        <value>32</value>
    </property>

    <!--存放application执行本地文件的根目录，执行完毕后删除，按用户名存储-->
     <property>
        <name>yarn.nodemanager.local-dirs</name>
        <value>
            /u01/hadoop/hdfs/data1/hadoop/yarn/local/,
            /u01/hadoop/hdfs/data2/hadoop/yarn/local/,
            /u01/hadoop/hdfs/data3/hadoop/yarn/local/,
            /u01/hadoop/hdfs/data4/hadoop/yarn/local/,
            /u01/hadoop/hdfs/data5/hadoop/yarn/local/
        </value>
    </property>
    <!--存放application本地执行日志的根目录，当启用日志聚合功能后，会在指定的时间后删除，按用户名存储-->
    <property>
        <name>yarn.nodemanager.log-dirs</name>
        <value>
            /u01/hadoop/hdfs/data1/hadoop/yarn/userlogs/,
            /u01/hadoop/hdfs/data2/hadoop/yarn/userlogs/,
            /u01/hadoop/hdfs/data3/hadoop/yarn/userlogs/,
            /u01/hadoop/hdfs/data4/hadoop/yarn/userlogs/,
            /u01/hadoop/hdfs/data5/hadoop/yarn/userlogs/
        </value>
    </property>
    <!--yarn 的本地job 运行日志的保留时间 20min-->
    <property>
        <name>yarn.nodemanager.log.retain-seconds</name>
        <value>1200</value>
    </property>


    <!--Whether to enable log aggregation. Log aggregation collects each container's logs and moves these logs onto a file-system, for e.g. HDFS -->
    <property>
        <name>yarn.log-aggregation-enable</name>
        <value>true</value>
    </property>
    <!--hdfs store logs,-->
    <property>
        <name>yarn.nodemanager.remote-app-log-dir</name>
        <value>/hadoop-job-logs</value>
    </property>
    <!--聚合后日志的具体hdfs 路径{yarn.log-aggregation-log}/{user}/{yarn.nodemanager.remote-app-log-dir-suffix}-->
    <property>
        <name>yarn.nodemanager.remote-app-log-dir-suffix</name>
        <value>/logs</value>
    </property>
    <property>
         <name>yarn.log-aggregation.retain-seconds</name>
         <value>259200</value>
    </property>

    <property>
        <description>The hostname of the Timeline service web application.</description>
        <name>yarn.timeline-service.hostname</name>
        <value>10.1.10.32</value>
    </property>

    <property>
        <description>Indicate to ResourceManager as well as clients whether
            history-service is enabled or not. If enabled, ResourceManager starts
            recording historical data that Timelien service can consume. Similarly,
            clients can redirect to the history service when applications
            finish if this is enabled.</description>
        <name>yarn.timeline-service.generic-application-history.enabled</name>
        <value>true</value>
    </property>

     <property>
        <name>yarn.log.server.url</name>
        <value>http://${yarn.resourcemanager.hostname}:19888/jobhistory/logs/</value>
    </property>

</configuration>
